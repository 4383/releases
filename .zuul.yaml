- job:
    name: releases-tox-list-changes
    parent: openstack-tox
    vars:
      tox_envlist: list-changes

# We only want one job publishing to the releases website at a time,
# otherwise we will clobber part of the output.
- semaphore:
    name: static-publish-releases
    max: 1

- project:
    name: openstack/releases
    check:
      jobs:
        - openstack-tox-validate:
            vars:
              zuul_site_upload_logs: true
        - releases-tox-list-changes:
            vars:
              zuul_site_upload_logs: true
        - build-openstack-sphinx-docs:
            vars:
              sphinx_python: python3
              zuul_site_upload_logs: true

    gate:
      jobs:
        - openstack-tox-validate
        - build-openstack-sphinx-docs:
            vars:
              sphinx_python: python3
    release-post:
      jobs:
        - tag-releases
        - publish-static:
            dependencies:
              - tag-releases
            semaphore: static-publish-releases
